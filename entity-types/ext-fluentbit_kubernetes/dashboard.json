{
  "name": "Kubernetes Fluent Bit monitoring",
  "description": null,
  "pages": [
    {
      "name": "Input",
      "description": null,
      "widgets": [
        {
          "title": "Input byte rate (bytes/minute)",
          "layout": {
            "column": 1,
            "row": 8,
            "width": 4,
            "height": 3
          },
          
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountIds": 0,,
                "query": "SELECT rate(sum(fluentbit_input_bytes_total), 1 minute) as 'bytes/minute' FROM Metric where name != 'fb-metrics-collector'  timeseries max facet name, pod_name"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": [],
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Input log rate (records/minute)",
          "layout": {
            "column": 5,
            "row": 8,
            "width": 4,
            "height": 3
          },
          
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountIds": 0,,
                "query": "SELECT rate(sum(fluentbit_input_records_total), 1 minute) as 'logs/minute' FROM Metric where name != 'fb-metrics-collector' facet name, pod_name timeseries max"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": [],
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Average incoming record size (bytes)",
          "layout": {
            "column": 9,
            "row": 8,
            "width": 4,
            "height": 3
          },
          
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountIds": 0,,
                "query": "SELECT sum(fluentbit_input_bytes_total)/sum(fluentbit_input_records_total) as 'Average incoming record size (bytes)' FROM Metric where name != 'fb-metrics-collector' facet name, pod_name timeseries max"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": [],
            "units": {
              "unit": "BYTES"
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        }
             ]
    },
    {
      "name": "Filter",
      "description": null,
      "widgets": [
        
        {
          "title": "Filter byte rate (bytes/minute)",
          "layout": {
            "column": 1,
            "row": 12,
            "width": 4,
            "height": 3
          },
          
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountIds": 0,,
                "query": "SELECT rate(sum(fluentbit_filter_bytes_total), 1 minute) FROM Metric facet name, pod_name timeseries max"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": [],
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Filter log rate (records/minute)",
          "layout": {
            "column": 5,
            "row": 12,
            "width": 4,
            "height": 3
          },
          
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountIds": 0,,
                "query": "SELECT rate(sum(fluentbit_filter_records_total), 1 minute) FROM Metric facet name, pod_name timeseries max"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": [],
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Average filtered record size (bytes)",
          "layout": {
            "column": 9,
            "row": 12,
            "width": 4,
            "height": 3
          },
          
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountIds": 0,,
                "query": "SELECT sum(fluentbit_filter_bytes_total)/sum(fluentbit_filter_records_total) AS 'Average filtered record size (bytes)' FROM Metric  facet name, pod_name timeseries max"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": [],
            "units": {
              "unit": "BYTES"
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Record add/drop rate per FILTER plugin",
          "layout": {
            "column": 1,
            "row": 15,
            "width": 4,
            "height": 3
          },
          
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountIds": 0,,
                "query": "SELECT rate(sum(fluentbit_filter_add_records_total), 1 minute) as 'Added back to pipeline', rate(sum(fluentbit_filter_drop_records_total), 1 minute) as 'Removed from pipeline' FROM Metric  facet name, pod_name timeseries MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": [],
            "units": {
              "unit": "REQUESTS_PER_MINUTE"
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        }
      ]
    },
    {
      "name": "Output",
      "description": null,
      "widgets": [
       
        {
          "title": "Output byte rate (bytes/minute)",
          "layout": {
            "column": 1,
            "row": 19,
            "width": 4,
            "height": 3
          },
          
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountIds": 0,,
                "query": "SELECT rate(sum(fluentbit_output_proc_bytes_total), 1 minute) as 'bytes/minute' FROM Metric where  name != 'fb-metrics-forwarder' facet name, pod_name timeseries max"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": [],
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Output log rate (records/minute)",
          "layout": {
            "column": 5,
            "row": 19,
            "width": 4,
            "height": 3
          },
          
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountIds": 0,,
                "query": "SELECT rate(sum(fluentbit_output_proc_records_total), 1 minute) as 'records/minute' FROM Metric where  name != 'fb-metrics-forwarder' facet name, pod_name timeseries MAX "
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": [],
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Average outgoing record size (bytes)",
          "layout": {
            "column": 9,
            "row": 19,
            "width": 4,
            "height": 3
          },
          
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountIds": 0,,
                "query": "SELECT sum(fluentbit_output_proc_bytes_total)/sum(fluentbit_output_proc_records_total) as 'bytes' FROM Metric where name != 'fb-metrics-forwarder' facet name, pod_name timeseries MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": [],
            "units": {
              "unit": "BYTES"
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "newrelic plugin statistics (records/minute)",
          "layout": {
            "column": 1,
            "row": 22,
            "width": 4,
            "height": 3
          },
          
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountIds": 0,,
                "query": "SELECT rate(sum(fluentbit_output_proc_records_total), 1 minute) as 'Processed', rate(sum(fluentbit_output_dropped_records_total), 1 minute) as 'Dropped', rate(sum(fluentbit_output_retried_records_total), 1 minute) as 'Retried' FROM Metric where name = 'newrelic-logs-forwarder' facet pod_name  timeseries max"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": [],
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Other OUTPUT plugin statistics (records/minute)",
          "layout": {
            "column": 5,
            "row": 22,
            "width": 4,
            "height": 3
          },
          
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountIds": 0,,
                "query": "SELECT rate(sum(fluentbit_output_proc_records_total), 1 minute) as 'Processed', rate(sum(fluentbit_output_dropped_records_total), 1 minute) as 'Dropped', rate(sum(fluentbit_output_retried_records_total), 1 minute) as 'Retried' FROM Metric where  name != 'newrelic-logs-forwarder' and name != 'fb-metrics-forwarder' facet name, pod_name timeseries max"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": [],
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Connections per OUTPUT plugin",
          "layout": {
            "column": 9,
            "row": 22,
            "width": 4,
            "height": 3
          },
          
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountIds": 0,,
                "query": "SELECT max(fluentbit_output_upstream_total_connections) as 'Total', max(fluentbit_output_upstream_busy_connections) as 'Busy' FROM Metric where cluster_name IN ({{cluster_name}}) AND name != 'fb-metrics-forwarder' facet name, pod_name timeseries MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": [],
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "newrelic plugin errors (errors/minute)",
          "layout": {
            "column": 1,
            "row": 25,
            "width": 4,
            "height": 3
          },
          
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountIds": 0,,
                "query": "SELECT rate(sum(fluentbit_output_errors_total), 1 minute) AS 'Errors/minute' FROM Metric where name = 'newrelic-logs-forwarder' facet pod_name timeseries MAX "
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": [],
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "newrelic plugin chunk retry statistics (retries/minute)",
          "layout": {
            "column": 5,
            "row": 25,
            "width": 4,
            "height": 3
          },
          
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountIds": 0,,
                "query": "SELECT rate(sum(fluentbit_output_retries_total), 1 minute) as 'Retries', rate(sum(fluentbit_output_retries_failed_total), 1 minute) as 'Expirations' FROM Metric where  name = 'newrelic-logs-forwarder' facet pod_name timeseries max"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": [],
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        }
      ]
    },
    {
      "name": "Memory usage",
      "description": null,
      "widgets": [
       
        {
          "title": "Input plugin memory usage",
          "layout": {
            "column": 1,
            "row": 29,
            "width": 4,
            "height": 3
          },
          
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountIds": 0,
                "query": "SELECT max(fluentbit_input_storage_memory_bytes) as 'Max' FROM Metric where  name != 'fb-metrics-collector' timeseries max facet name, pod_name "
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": [],
            "units": {
              "unit": "BYTES"
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "INPUT memory buffer over limit",
          "layout": {
            "column": 5,
            "row": 29,
            "width": 4,
            "height": 3
          },
          
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "colors": {
              "seriesOverrides": [
                {
                  "color": "#013ef4",
                  "seriesName": "pod-logs-tailer"
                }
              ]
            },
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountIds": 0,
                "query": "SELECT max(fluentbit_input_storage_overlimit) FROM Metric where  name != 'fb-metrics-collector' timeseries max facet name, pod_name"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": [],
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Chunk statistics per INPUT plugin",
          "layout": {
            "column": 9,
            "row": 29,
            "width": 4,
            "height": 3
          },
          
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountIds": 0,
                "query": "SELECT average(fluentbit_input_storage_chunks_up) AS 'Up (in memory)', average(fluentbit_input_storage_chunks_down) AS 'Down (in fs)', average(fluentbit_input_storage_chunks_busy) AS 'Busy', average(fluentbit_input_storage_chunks) as 'Total'  FROM Metric where name != 'fb-metrics-collector' since 1 hour ago timeseries MAX facet name, pod_name "
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": [],
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Buffered chunks",
          "layout": {
            "column": 1,
            "row": 32,
            "width": 4,
            "height": 3
          },
          
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountIds": 0,,
                "query": "SELECT max(fluentbit_input_storage_chunks) AS 'Total', max(fluentbit_storage_mem_chunks) AS 'Memory', max(fluentbit_storage_fs_chunks) AS 'Filesystem'  FROM Metric facet pod_name timeseries MAX "
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": [],
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Busy chunks' size",
          "layout": {
            "column": 5,
            "row": 32,
            "width": 4,
            "height": 3
          },
          
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountIds": 0,,
                "query": "SELECT max(fluentbit_input_storage_chunks_busy_bytes) FROM Metric where name != 'fb-metrics-collector' facet name, pod_name timeseries MAX since 1 hour ago"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": [],
            "units": {
              "unit": "BYTES"
            },
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        },
        {
          "title": "Filesystem chunks state",
          "layout": {
            "column": 9,
            "row": 32,
            "width": 4,
            "height": 3
          },
          
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountIds": 0,,
                "query": "SELECT average(fluentbit_storage_fs_chunks_up) AS 'Up (in memory)', average(fluentbit_storage_fs_chunks_down) AS 'Down (fs only)'  FROM Metric timeseries MAX "
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": [],
            "yAxisLeft": {
              "zero": true
            },
            "yAxisRight": {
              "zero": true
            }
          }
        }
      ]
    }
  ],
  "variables": [
    {
      "name": "cluster_name",
      "items": null,
      "defaultValues": [
        {
          "value": {
            "string": "*"
          }
        }
      ],
      "nrqlQuery": {
        "accountIds": [
          2106306
        ],
        "query": "SELECT uniques(cluster_name) FROM Metric where metricName = 'fluentbit_input_storage_overlimit'"
      },
      "options": {
        "ignoreTimeRange": false,
        "excluded": false
      },
      "title": "Cluster Name",
      "type": "NRQL",
      "isMultiSelection": true,
      "replacementStrategy": "STRING"
    }
  ]
}