domain: INFRA
type: RABBITMQNODE

goldenTags:
  - account
  # RabbitMQ OHI
  # OpenTelemetry
  - rabbitmq.node.name
  - rabbitmq.vhost.name

synthesis:
  rules:
    - identifier:
      name: rabbitmq.node.name
      encodeIdentifierInGUID: true
      conditions:
        - attribute: eventType
          value: Metric
        # All metrics from the receiver starts with the 'rabbitmq.' prefix.
        - attribute: metricName
          prefix: rabbitmq.
        - attribute: instrumentation.provider
          value: opentelemetry
        # This filters only metrics coming from rabbitmq receiver, given that metrics
        # could differ between different runtime receivers.
        - attribute: otel.library.name
          value: otelcol/rabbitmqreceiver
      tags:
        # Default resource attributes
        rabbitmq.version:
        # Attributes
        rabbitmq.node.name:
        # Environment resource attributes
        host.type:
        cloud.provider:
        cloud.account.id:
        cloud.region:
        # OTel attributes
        # The library name contains the name of the receiver that is used to identify the source
        # and select the dashboard.
        otel.library.name:
          entityTagName: instrumentation.name

  tags:
    # For OpenTelemetry
    telemetry.sdk.name:
      entityTagName: instrumentation.provider
    # AWS tags
    aws.region:

configuration:
  entityExpirationTime: DAILY
  alertable: true

dashboardTemplates:
  # This should match the entity created from the ohi in the infra pipeline
  newRelic:
    template: newrelic_dashboard.json
