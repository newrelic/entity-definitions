domain: EXT
type: ISTIO_SERVICE
synthesis:
  rules:
    # prometheus
    - compositeIdentifier:
        separator: ":"
        attributes:
          - cluster_name
          - namespace
          - service_istio_io_canonical_name
      encodeIdentifierInGUID: true
      name: service_istio_io_canonical_name
      conditions:
        - attribute: metricName
          prefix: istio_requests

    - compositeIdentifier:
        separator: ":"
        attributes:
          - cluster_name
          - namespace
          - service_istio_io_canonical_name
      encodeIdentifierInGUID: true
      name: service_istio_io_canonical_name
      conditions:
        - attribute: metricName
          prefix: istio_tcp

  tags:
    # prometheus
    cluster_name:
      entityTagName: k8s.clusterName
      ttl: P1D
    deployment:
      entityTagName: k8s.deploymentName
      ttl: P1D
    namespace:
      entityTagName: k8s.namespaceName
      ttl: P1D
    pod:
      entityTagName: k8s.podName
      ttl: P1D

    # otel
    k8s.cluster.name:
      entityTagName: k8s.clusterName
      ttl: P1D
    k8s.deployment.name:
      entityTagName: k8s.deploymentName
      ttl: P1D
    k8s.namespace.name:
      entityTagName: k8s.namespaceName
      ttl: P1D
    k8s.pod.name:
      entityTagName: k8s.podName
      ttl: P1D

    service_istio_io_canonical_revision:
    app:
    version:
    label.istio:
    istio_io_rev:
    operator_istio_io_component:

goldenTags:
  - k8s.clusterName
  - k8s.namespaceName

dashboardTemplates:
  newRelic:
    template: dashboard.json
  prometheus:
    template: dashboard.json

configuration:
  entityExpirationTime: FOUR_HOURS
  alertable: true
