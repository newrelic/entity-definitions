{
  "name": "MssqlInstance",
  "pages": [
    {
      "name": "MssqlInstance",
      "widgets": [
        {
          "title": "Total Failed Logins",
          "layout": {
            "column": 1,
            "row": 1,
            "width": 2,
            "height": 3
          },
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "SELECT latest(sqlserver.user_connections.authentication.total_failed_logins) AS 'Total Failed Logins' FROM Metric"
              }
            ]
          }
        },
        {
          "title": "Primary vs Local Replica Distribution",
          "layout": {
            "column": 3,
            "row": 1,
            "width": 5,
            "height": 3
          },
          "visualization": {
            "id": "viz.table"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "FROM Metric SELECT latest(sqlserver.failover_cluster.is_primary_replica ) AS 'Is Primary' , latest(sqlserver.failover_cluster.is_local_replica) AS 'Is Local' facet replica_server_name, database_name, synchronization_state_desc"
              }
            ]
          }
        },
        {
          "title": "Availability Group Synchronization Health",
          "layout": {
            "column": 8,
            "row": 1,
            "width": 5,
            "height": 3
          },
          "visualization": {
            "id": "viz.table"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "FROM Metric SELECT latest(sqlserver.failover_cluster.ag_synchronization_health) FACET replica_server_name, synchronization_health_desc"
              }
            ]
          }
        },
        {
          "title": "Login & Logout Rate (per second)",
          "layout": {
            "column": 1,
            "row": 4,
            "width": 3,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "SELECT latest(sqlserver.user_connections.authentication.logins_per_sec) AS 'Logins/sec', latest(sqlserver.user_connections.authentication.logouts_per_sec) AS 'Logouts/sec' FROM Metric TIMESERIES"
              }
            ]
          }
        },
        {
          "title": "Active Connections",
          "layout": {
            "column": 4,
            "row": 4,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "SELECT latest(`activeConnections`) FROM Metric TIMESERIES AUTO "
              }
            ]
          }
        },
        {
          "title": "Total & Available Physical Memory",
          "layout": {
            "column": 8,
            "row": 4,
            "width": 5,
            "height": 3
          },
          "visualization": {
            "id": "viz.area"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "FROM Metric SELECT average(sqlserver.instance.memory_total), average(sqlserver.instance.memory_available) TIMESERIES AUTO "
              }
            ]
          }
        },
        {
          "title": "Average execution time (ms)",
          "layout": {
            "column": 1,
            "row": 7,
            "width": 6,
            "height": 3
          },
          "visualization": {
            "id": "viz.table"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "SELECT average(sqlserver.slowquery.avg_elapsed_time_ms) FROM Metric \nWHERE metricName = 'sqlserver.slowquery.avg_elapsed_time_ms' \nAND QueryID IN (\n    SELECT QueryID FROM Metric \n    WHERE metricName = 'sqlserver.slowquery.query_text'\n) \nFACET QueryID"
              }
            ]
          }
        },
        {
          "title": "Disk Space Utilization",
          "layout": {
            "column": 7,
            "row": 7,
            "width": 6,
            "height": 3
          },
          "visualization": {
            "id": "viz.pie"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "SELECT\n       latest(sqlserver.database.pageFileTotal) / 1024 / 1024 / 1024 as 'Used Space (GB)',\n       latest(sqlserver.database.pageFileAvailable) / 1024 / 1024 / 1024 as 'Disk Utilization (GB)'\nFROM Metric \nWHERE metricName IN ('sqlserver.database.pageFileTotal', 'sqlserver.database.pageFileAvailable')\nFACET database_name SINCE 1 hour ago"
              }
            ]
          }
        },
        {
          "title": "Wait Events by Category",
          "layout": {
            "column": 1,
            "row": 10,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.pie"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "SELECT \n  sum(sqlserver.wait_analysis.total_wait_time_ms) as 'Total Wait Time (ms)'\nFROM Metric \nWHERE metricName = 'sqlserver.wait_analysis.total_wait_time_ms'\nFACET WaitCategory\n"
              }
            ]
          }
        },
        {
          "title": "Wait Time Per Lock Wait (ms)",
          "layout": {
            "column": 5,
            "row": 10,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "FROM Metric SELECT average(sqlserver.stats.lock_waits_per_sec) AS 'Avg Lock Wait Time (ms)' TIMESERIES AUTO"
              }
            ]
          }
        },
        {
          "title": "Total page file space per database",
          "layout": {
            "column": 9,
            "row": 10,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.stacked-bar"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "SELECT average(`sqlserver.database.pageFileTotal`) / 1024 / 1024 as 'Total Page File (MB)'\nFROM Metric \nWHERE `metric.type` = 'gauge' \nAND `metric.source` = 'sys.partitions_sys.allocation_units'\nFACET database_name\nSINCE 1 hour ago \nTIMESERIES"
              }
            ]
          }
        }
      ]
    }
  ]
}