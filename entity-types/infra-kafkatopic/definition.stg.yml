domain: INFRA
type: KAFKATOPIC
configuration:
  entityExpirationTime: DAILY
  alertable: true

synthesis:
  rules:
    # This rule is for OTEL contrib jmx kafka receivers metrics
    - ruleName: infra_kafkatopic_kafka_topic_name_stg
      identifier: kafka.topic.name
      name: kafka.topic.name
      encodeIdentifierInGUID: true
      conditions:
        - attribute: eventType
          value: Metric
        - attribute: topic
          present: true
        - attribute: instrumentation.provider
          value: opentelemetry
        - attribute: metricName
          prefix: kafka.
        - attribute: otel.library.name
          value: "io.opentelemetry.contrib.jmxmetrics"
      tags:
        # Environment resource attributes
        host.name:
          entityTagName: hostName
        instrumentation.provider:
        kafka.cluster.name:
          entityTagName: clusterName
        otel.library.name:
          entityTagName: instrumentation.name
        topic:
        k8s.namespace.name:


    # This rule is for OTEL JMX Kafka receivers with custom JMX configuration metrics
    - ruleName: infra_kafkatopic_kafka_topic_name_stg_2
      identifier: kafka.topic.name
      name: kafka.topic.name
      encodeIdentifierInGUID: true
      conditions:
        - attribute: eventType
          value: Metric
        - attribute: topic
          present: true
        - attribute: instrumentation.provider
          value: opentelemetry
        - attribute: otel.library.name
          value: "io.opentelemetry.jmx"
      tags:
        # Environment resource attributes
        host.name:
          entityTagName: hostName
        instrumentation.provider:
        kafka.cluster.name:
          entityTagName: clusterName
        otel.library.name:
          entityTagName: instrumentation.name
        topic:
        k8s.namespace.name:

      # This rule is for OTEL kafkametrics receivers metrics
    - ruleName: infra_kafkatopic_kafka_topic_name_stg_3
      identifier: kafka.topic.name
      name: kafka.topic.name
      encodeIdentifierInGUID: true
      conditions:
        - attribute: eventType
          value: Metric
        - attribute: topic
          present: true
        - attribute: instrumentation.provider
          value: opentelemetry
        - attribute: otel.library.name
          value: "github.com/open-telemetry/opentelemetry-collector-contrib/receiver/kafkametricsreceiver"
      tags:
        # Environment resource attributes
        host.name:
          entityTagName: hostName
        instrumentation.provider:
        kafka.cluster.name:
          entityTagName: clusterName
        otel.library.name:
          entityTagName: instrumentation.name
        topic:
        k8s.namespace.name:

dashboardTemplates:
  # This should match the entity created from the ohi in the infra pipeline
  newRelic:
    template: newrelic_dashboard.json
  # otel receiver
  opentelemetry:
    template: opentelemetry_dashboard.stg.json

goldenTags:
- clusterName
- hostName
- topic

ownership:
  primaryOwner:
    teamName: "OnHost Agent and Integrations"
