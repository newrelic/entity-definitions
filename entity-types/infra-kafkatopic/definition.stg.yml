domain: INFRA
type: KAFKATOPIC
configuration:
  entityExpirationTime: DAILY
  alertable: true

synthesis:
  rules:
  # This rule is for OTEL contrib jmx kafka receivers metrics
  - identifier: kafka.topic.name
    name: kafka.topic.name
    encodeIdentifierInGUID: true
    conditions:
      - attribute: eventType
        value: Metric
      - attribute: topic
        present: true
      - attribute: instrumentation.provider
        value: opentelemetry
      - attribute: metricName
        prefix: kafka.
      - attribute: service.instance.id
        present: false
      - attribute: otel.library.name
        value: "io.opentelemetry.contrib.jmxmetrics"
    tags:
      # Environment resource attributes
      host.name:
        entityTagName: hostName
      instrumentation.provider:
      kafka.cluster.name:
        entityTagName: clusterName
      otel.library.name:
        entityTagName: instrumentation.name
      topic:

  # This rule is for OTEL JMX Kafka receivers with custom JMX configuration metrics
  - identifier: kafka.topic.name
    name: kafka.topic.name
    encodeIdentifierInGUID: true
    conditions:
      - attribute: eventType
        value: Metric
      - attribute: topic
        present: true
      - attribute: instrumentation.provider
        value: opentelemetry
      - attribute: metricName
        prefix: kafka.
      - attribute: service.instance.id
        present: false
      - attribute: otel.library.name
        value: "io.opentelemetry.jmx"
    tags:
      # Environment resource attributes
      host.name:
        entityTagName: hostName
      instrumentation.provider:
      kafka.cluster.name:
        entityTagName: clusterName
      otel.library.name:
        entityTagName: instrumentation.name
      topic:

    # This rule is for OTEL kafkametrics receivers metrics
  - identifier: kafka.topic.name
    name: kafka.topic.name
    encodeIdentifierInGUID: true
    conditions:
      - attribute: eventType
        value: Metric
      - attribute: topic
        present: true
      - attribute: instrumentation.provider
        value: opentelemetry
      - attribute: metricName
        prefix: kafka.
      - attribute: service.instance.id
        present: false
      - attribute: otel.library.name
        value: "github.com/open-telemetry/opentelemetry-collector-contrib/receiver/kafkametricsreceiver"
    tags:
      # Environment resource attributes
      host.name:
        entityTagName: hostName
      instrumentation.provider:
      kafka.cluster.name:
        entityTagName: clusterName
      otel.library.name:
        entityTagName: instrumentation.name
      topic:

dashboardTemplates:
  # This should match the entity created from the ohi in the infra pipeline
  newRelic:
    template: newrelic_dashboard.json
  # otel receiver
  opentelemetry:
    template: opentelemetry_dashboard.stg.json

goldenTags:
- clusterName
- hostName
- topic
