bytesInPerSecond:
  title: "OTel: Bytes in per second"
  unit: BYTES_PER_SECOND
  queries:
    opentelemetry:
      select: rate(sum(kafka.topic.io), 1 second)
      from: Metric
      where: metricName = 'kafka.topic.io' AND (state = 'in' OR direction = 'in')
      eventId: entity.guid

bytesOutPerSecond:
  title: "OTel: Bytes out per second"
  unit: BYTES_PER_SECOND
  queries:
    opentelemetry:
      select: rate(sum(kafka.topic.io), 1 second)
      from: Metric
      where: metricName = 'kafka.topic.io' AND (state = 'out' OR direction = 'out')
      eventId: entity.guid

messagesInPerSecond:
  title: "OTel: Messages in per second"
  unit: MESSAGES_PER_SECOND
  queries:
    opentelemetry:
      select: rate(sum(kafka.prod.msg.count), 1 second)
      from: Metric
      where: metricName = 'kafka.prod.msg.count'
      eventId: entity.guid

consumerGroupLag:
  title: "OTel: Consumer group lag"
  queries:
    opentelemetry:
      select: latest(kafka.consumer_group.lag_sum)
      from: Metric
      where: metricName = 'kafka.consumer_group.lag_sum'
      eventId: entity.guid
      facet: group

underReplicatedPartitions:
  unit: COUNT
  title: "NR: Under-replicated partitions"
  queries:
    newRelic:
      select: latest(topic.underReplicatedPartitions)
      from: KafkaTopicSample
      eventId: entityGuid
      eventName: entityName

partitionsWithNonPreferredLeader:
  title: "NR: Non-preferred leader Partitions"
  unit: COUNT
  queries:
    newRelic:
      select: average(topic.partitionsWithNonPreferredLeader)
      from: KafkaTopicSample
      eventId: entityGuid
      eventName: entityName