{
  "name": "Prometheus Agent",
  "description": null,
  "pages": [
    {
      "name": "Prometheus Monitoring",
      "description": null,
      "widgets": [
        {
          "title": "",
          "layout": {
            "column": 1,
            "row": 1,
            "width": 3,
            "height": 3
          },
          "visualization": {
            "id": "viz.markdown"
          },
          "rawConfiguration": {
            "text": "# Overview\n\nThis dashboard provides insight into the metrics collected into this account via the [Prometheus Agent](https://github.com/newrelic/newrelic-prometheus-configurator)."
          }
        },
        {
          "title": "Samples Sent/Sec by Source",
          "layout": {
            "column": 4,
            "row": 1,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "FROM Metric SELECT rate(sum(prometheus_remote_storage_samples_in_total), 1 second) AS 'Samples Appended / Sec' WHERE collector.name = 'prometheus-agent' AND cluster_name = '{{tags.k8s.clusterName}}' FACET prometheus_server TIMESERIES AUTO LIMIT MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "yAxisLeft": {
              "zero": true
            }
          }
        },
        {
          "title": "Samples Sent/Sec by Source (Area)",
          "layout": {
            "column": 8,
            "row": 1,
            "width": 5,
            "height": 3
          },
          "visualization": {
            "id": "viz.area"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "FROM Metric SELECT rate(sum(prometheus_remote_storage_samples_in_total), 1 second) AS 'Samples Appended / Sec' WHERE collector.name = 'prometheus-agent' AND cluster_name = '{{tags.k8s.clusterName}}' FACET prometheus_server TIMESERIES AUTO LIMIT MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Unique Metric Name by Source",
          "layout": {
            "column": 1,
            "row": 4,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "FROM Metric SELECT uniqueCount(metricName) WHERE collector.name = 'prometheus-agent' AND cluster_name = '{{tags.k8s.clusterName}}' FACET prometheus_server LIMIT MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Unique Timeseries by Source (metric cardinality)",
          "layout": {
            "column": 5,
            "row": 4,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "FROM Metric SELECT cardinality() AS 'Time Series' WHERE collector.name = 'prometheus-agent' AND cluster_name = '{{tags.k8s.clusterName}}' FACET prometheus_server LIMIT MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "thresholds": [
              {
                "alertSeverity": "CRITICAL",
                "value": 200000
              },
              {
                "alertSeverity": "WARNING",
                "value": 100000
              }
            ]
          }
        },
        {
          "title": "Unique Timeseries by Metric (metric cardinality)",
          "layout": {
            "column": 9,
            "row": 4,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.bar"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "FROM Metric SELECT cardinality(metricName) WHERE collector.name = 'prometheus-agent' AND cluster_name = '{{tags.k8s.clusterName}}' FACET metricName LIMIT MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Active Series by Source",
          "layout": {
            "column": 1,
            "row": 7,
            "width": 3,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "FROM Metric SELECT latest(prometheus_agent_active_series) WHERE collector.name = 'prometheus-agent' AND cluster_name = '{{tags.k8s.clusterName}}' FACET prometheus_server TIMESERIES"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "yAxisLeft": {
              "zero": true
            }
          }
        },
        {
          "title": "Pending Samples by Source",
          "layout": {
            "column": 4,
            "row": 7,
            "width": 3,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "FROM Metric SELECT latest(prometheus_remote_storage_samples_pending) WHERE collector.name = 'prometheus-agent' AND cluster_name = '{{tags.k8s.clusterName}}' FACET prometheus_server TIMESERIES AUTO LIMIT MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "yAxisLeft": {
              "zero": true
            }
          }
        },
        {
          "title": "Samples Retried by Source",
          "layout": {
            "column": 7,
            "row": 7,
            "width": 3,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "FROM Metric SELECT sum(prometheus_remote_storage_samples_retried_total) WHERE collector.name = 'prometheus-agent' AND cluster_name = '{{tags.k8s.clusterName}}' FACET prometheus_server TIMESERIES AUTO LIMIT MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "yAxisLeft": {
              "zero": true
            }
          }
        },
        {
          "title": "Failed Samples by Source",
          "layout": {
            "column": 10,
            "row": 7,
            "width": 3,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "FROM Metric SELECT rate(sum(prometheus_remote_storage_samples_failed_total), 1 second) AS 'Samples Failed/Sec' WHERE collector.name = 'prometheus-agent' AND cluster_name = '{{tags.k8s.clusterName}}' FACET prometheus_server TIMESERIES AUTO LIMIT MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "yAxisLeft": {
              "zero": true
            }
          }
        },
        {
          "title": "Memory by Source+Job",
          "layout": {
            "column": 1,
            "row": 10,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "FROM Metric SELECT latest(process_resident_memory_bytes), latest(process_virtual_memory_bytes) WHERE collector.name = 'prometheus-agent' AND cluster_name = '{{tags.k8s.clusterName}}' TIMESERIES AUTO FACET prometheus_server,job LIMIT MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "yAxisLeft": {
              "zero": true
            }
          }
        },
        {
          "title": "CPU by Source+Job",
          "layout": {
            "column": 5,
            "row": 10,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "FROM Metric SELECT rate(latest(process_cpu_seconds_total),1 second)*100 WHERE collector.name = 'prometheus-agent' AND cluster_name = '{{tags.k8s.clusterName}}' TIMESERIES AUTO FACET prometheus_server,job LIMIT MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "yAxisLeft": {
              "zero": true
            }
          }
        },
        {
          "title": "Targets Failed to Scrape by Source",
          "layout": {
            "column": 9,
            "row": 10,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "FROM Metric SELECT filter(latest(up), WHERE up[latest]=0) WHERE collector.name = 'prometheus-agent' AND cluster_name = '{{tags.k8s.clusterName}}' FACET prometheus_server TIMESERIES auto"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "yAxisLeft": {
              "zero": true
            }
          }
        },
        {
          "title": "Total Prometheus Server Instances (Shards) by Cluster",
          "layout": {
            "column": 1,
            "row": 13,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "FROM Metric SELECT UniqueCount(prometheus_server) as 'Prometheus Shards Count' WHERE collector.name = 'prometheus-agent' AND cluster_name = '{{tags.k8s.clusterName}}' FACET cluster_name"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Target Interval Length by Source+Quantile",
          "layout": {
            "column": 5,
            "row": 13,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "FROM Metric SELECT max(prometheus_target_interval_length_seconds) WHERE collector.name = 'prometheus-agent' AND cluster_name = '{{tags.k8s.clusterName}}' FACET prometheus_server,quantile as quantile TIMESERIES LIMIT MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "yAxisLeft": {
              "zero": true
            }
          }
        },
        {
          "title": "Max Scrape Duration by Source+Job",
          "layout": {
            "column": 9,
            "row": 13,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "FROM Metric SELECT max(scrape_duration_seconds) WHERE collector.name = 'prometheus-agent' AND cluster_name = '{{tags.k8s.clusterName}}' TIMESERIES AUTO FACET prometheus_server,job LIMIT MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "yAxisLeft": {
              "zero": true
            }
          }
        },
        {
          "title": "Remote Write Threads by Source",
          "layout": {
            "column": 1,
            "row": 16,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.bar"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "FROM Metric SELECT latest(prometheus_remote_storage_shards) WHERE collector.name = 'prometheus-agent' AND cluster_name = '{{tags.k8s.clusterName}}' FACET prometheus_server LIMIT MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            }
          }
        },
        {
          "title": "Total WAL Corruptions by Source",
          "layout": {
            "column": 5,
            "row": 16,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "FROM Metric SELECT sum(prometheus_agent_corruptions_total) WHERE collector.name = 'prometheus-agent' AND cluster_name = '{{tags.k8s.clusterName}}' FACET prometheus_server TIMESERIES auto LIMIT MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "yAxisLeft": {
              "zero": true
            }
          }
        },
        {
          "title": "Checkpoint Creation/Deletion Failed by Source",
          "layout": {
            "column": 9,
            "row": 16,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "FROM Metric SELECT sum(prometheus_agent_checkpoint_creations_failed_total), sum(prometheus_agent_checkpoint_deletions_failed_total) WHERE collector.name = 'prometheus-agent' AND cluster_name = '{{tags.k8s.clusterName}}' FACET prometheus_server TIMESERIES auto LIMIT MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "yAxisLeft": {
              "zero": true
            }
          }
        },
        {
          "title": "Service Discovery K8s Https Requests by Source+Status",
          "layout": {
            "column": 1,
            "row": 19,
            "width": 6,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "FROM Metric SELECT sum(prometheus_sd_kubernetes_http_request_total) WHERE collector.name = 'prometheus-agent' AND cluster_name = '{{tags.k8s.clusterName}}' FACET prometheus_server, status_code TIMESERIES AUTO LIMIT MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "yAxisLeft": {
              "zero": true
            }
          }
        },
        {
          "title": "Service Discovery K8s Events by Source+Role",
          "layout": {
            "column": 7,
            "row": 19,
            "width": 6,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "facet": {
              "showOtherSeries": false
            },
            "legend": {
              "enabled": true
            },
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "FROM Metric SELECT sum(prometheus_sd_kubernetes_events_total) WHERE collector.name = 'prometheus-agent' AND cluster_name = '{{tags.k8s.clusterName}}' FACET prometheus_server,role TIMESERIES AUTO LIMIT MAX"
              }
            ],
            "platformOptions": {
              "ignoreTimeRange": false
            },
            "yAxisLeft": {
              "zero": true
            }
          }
        }
      ]
    }
  ]
}