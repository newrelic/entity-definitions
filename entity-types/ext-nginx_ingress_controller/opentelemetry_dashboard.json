{
  "name": "NGINX Ingress Controller (Prometheus)",
  "description": null,
  "pages":
    [
      {
        "name": "NGINX Ingress Controller",
        "description": null,
        "widgets":
          [
            {
              "title": "",
              "layout": { "column": 1, "row": 1, "width": 4, "height": 3 },
              "visualization": { "id": "viz.markdown" },
              "rawConfiguration":
                {
                  "text": "![nginx-logo](https://raw.githubusercontent.com/newrelic/newrelic-quickstarts/main/quickstarts/kubernetes/nginx/logo.png)\n\n### Overview\n\nThe NGINX ingress controller exposes many useful metrics that can be scraped by a Prometheus server or agent. These metrics can inform you of ongoing process connections and the current ingress load that your system is handling. Furthermore, these metrics can inform you on ingress config reloads and empower alert conditions on config reload errors or unexpected config changes.\n\n\n\n---\n\n### About this Dashboard\n\nThis dashboard is based on metrics sent to New Relic using [Prometheus Agent or Prometheus Server.](https://docs.newrelic.com/docs/infrastructure/prometheus-integrations/get-started/send-prometheus-metric-data-new-relic/)\n\nFor information on the prerequisites for this dashboard, please visit [our documentation here.](https://docs.newrelic.com/docs/infrastructure/prometheus-integrations/integrations-list/ingress-controller-integration)"
                }
            },
            {
              "title": "Error during config reload",
              "layout": { "column": 5, "row": 1, "width": 4, "height": 3 },
              "visualization": { "id": "viz.billboard" },
              "rawConfiguration":
                {
                  "facet": { "showOtherSeries": false },
                  "nrqlQueries":
                    [
                      {
                        "accountId": 0,
                        "query": "FROM Metric SELECT if(latest(nginx_ingress_controller_config_last_reload_successful) < 1, 'Errors', 'No Errors') AS 'Last config reload errors'"
                      }
                    ],
                  "platformOptions": { "ignoreTimeRange": false }
                }
            },
            {
              "title": "Last successful config reload",
              "layout": { "column": 9, "row": 1, "width": 4, "height": 3 },
              "visualization": { "id": "viz.billboard" },
              "rawConfiguration":
                {
                  "dataFormatters":
                    [
                      {
                        "name": "Last successful config reload",
                        "type": "date"
                      }
                    ],
                  "facet": { "showOtherSeries": false },
                  "nrqlQueries":
                    [
                      {
                        "accountId": 0,
                        "query": "FROM Metric SELECT latest(nginx_ingress_controller_config_last_reload_successful_timestamp_seconds) * 1000 as 'Last successful config reload'"
                      }
                    ],
                  "platformOptions": { "ignoreTimeRange": false }
                }
            },
            {
              "title": "Ingress classes",
              "layout": { "column": 1, "row": 4, "width": 6, "height": 3 },
              "visualization": { "id": "viz.pie" },
              "rawConfiguration":
                {
                  "facet": { "showOtherSeries": true },
                  "legend": { "enabled": true },
                  "nrqlQueries":
                    [
                      {
                        "accountId": 0,
                        "query": "FROM Metric SELECT count(nginx_ingress_controller_requests)"
                      }
                    ],
                  "platformOptions": { "ignoreTimeRange": false }
                }
            },
            {
              "title": "Ratio of requests by status",
              "layout": { "column": 7, "row": 4, "width": 3, "height": 3 },
              "visualization": { "id": "viz.pie" },
              "rawConfiguration":
                {
                  "facet": { "showOtherSeries": true },
                  "legend": { "enabled": true },
                  "nrqlQueries":
                    [
                      {
                        "accountId": 0,
                        "query": "FROM Metric SELECT sum(nginx_ingress_controller_requests) FACET status"
                      }
                    ],
                  "platformOptions": { "ignoreTimeRange": false }
                }
            },
            {
              "title": "Requests per second by status",
              "layout": { "column": 10, "row": 4, "width": 3, "height": 3 },
              "visualization": { "id": "viz.line" },
              "rawConfiguration":
                {
                  "facet": { "showOtherSeries": false },
                  "legend": { "enabled": true },
                  "nrqlQueries":
                    [
                      {
                        "accountId": 0,
                        "query": "FROM Metric SELECT rate(sum(nginx_ingress_controller_request_size, 1 SECONDS) FACET status TIMESERIES"
                      }
                    ],
                  "platformOptions": { "ignoreTimeRange": false },
                  "yAxisLeft": { "zero": true }
                }
            },
            {
              "title": "Average process connections",
              "layout": { "column": 1, "row": 7, "width": 4, "height": 3 },
              "visualization": { "id": "viz.line" },
              "rawConfiguration":
                {
                  "facet": { "showOtherSeries": false },
                  "legend": { "enabled": true },
                  "nrqlQueries":
                    [
                      {
                        "accountId": 0,
                        "query": "FROM Metric SELECT average(nginx_ingress_controller_nginx_process_connections_total) AS 'Average process connections' TIMESERIES"
                      }
                    ],
                  "platformOptions": { "ignoreTimeRange": false },
                  "yAxisLeft": { "zero": true }
                }
            },
            {
              "title": "CPU second rate by pod",
              "layout": { "column": 5, "row": 7, "width": 4, "height": 3 },
              "visualization": { "id": "viz.line" },
              "rawConfiguration":
                {
                  "facet": { "showOtherSeries": false },
                  "legend": { "enabled": true },
                  "nrqlQueries":
                    [
                      {
                        "accountId": 0,
                        "query": "FROM Metric SELECT rate(sum(nginx_ingress_controller_nginx_process_cpu_seconds_total), 1 SECONDS) FACET controller_pod TIMESERIES"
                      }
                    ],
                  "platformOptions": { "ignoreTimeRange": false },
                  "yAxisLeft": { "zero": true }
                }
            },
            {
              "title": "Process memory bytes by pod",
              "layout": { "column": 9, "row": 7, "width": 4, "height": 3 },
              "visualization": { "id": "viz.line" },
              "rawConfiguration":
                {
                  "facet": { "showOtherSeries": false },
                  "legend": { "enabled": true },
                  "nrqlQueries":
                    [
                      {
                        "accountId": 0,
                        "query": "FROM Metric SELECT rate(sum(nginx_ingress_controller_nginx_process_resident_memory_bytes), 1 SECONDS) FACET controller_pod TIMESERIES"
                      }
                    ],
                  "platformOptions": { "ignoreTimeRange": false },
                  "units": { "unit": "BYTES" },
                  "yAxisLeft": { "zero": true }
                }
            },
            {
              "title": "",
              "layout": { "column": 1, "row": 10, "width": 12, "height": 1 },
              "visualization": { "id": "viz.markdown" },
              "rawConfiguration": { "text": "# Requests Stats" }
            },
            {
              "title": "Request size buckets",
              "layout": { "column": 1, "row": 11, "width": 6, "height": 3 },
              "visualization": { "id": "viz.line" },
              "rawConfiguration":
                {
                  "facet": { "showOtherSeries": false },
                  "legend": { "enabled": true },
                  "nrqlQueries":
                    [
                      {
                        "accountId": 0,
                        "query": "SELECT percentile(nginx_ingress_controller_request_size, 50, 75, 90) As 'Request size' FROM Metric TIMESERIES"
                      }
                    ],
                  "platformOptions": { "ignoreTimeRange": false },
                  "yAxisLeft": { "zero": true }
                }
            },
            {
              "title": "Request duration seconds ",
              "layout": { "column": 7, "row": 11, "width": 6, "height": 3 },
              "visualization": { "id": "viz.line" },
              "rawConfiguration":
                {
                  "facet": { "showOtherSeries": false },
                  "legend": { "enabled": true },
                  "nrqlQueries":
                    [
                      {
                        "accountId": 0,
                        "query": "SELECT percentile(nginx_ingress_controller_request_duration_seconds, 50, 75, 90) As 'Request duration' FROM Metric TIMESERIES"
                      }
                    ],
                  "platformOptions": { "ignoreTimeRange": false },
                  "yAxisLeft": { "zero": true }
                }
            },
            {
              "title": "",
              "layout": { "column": 1, "row": 14, "width": 12, "height": 1 },
              "visualization": { "id": "viz.markdown" },
              "rawConfiguration": { "text": "# Response Stats" }
            },
            {
              "title": "Response size buckets",
              "layout": { "column": 1, "row": 15, "width": 6, "height": 3 },
              "visualization": { "id": "viz.line" },
              "rawConfiguration":
                {
                  "facet": { "showOtherSeries": false },
                  "legend": { "enabled": true },
                  "nrqlQueries":
                    [
                      {
                        "accountId": 0,
                        "query": "SELECT percentile(nginx_ingress_controller_response_size, 50, 75, 90) As 'Response size' FROM Metric TIMESERIES"
                      }
                    ],
                  "platformOptions": { "ignoreTimeRange": false },
                  "yAxisLeft": { "zero": true }
                }
            },
            {
              "title": "Response duration seconds",
              "layout": { "column": 7, "row": 15, "width": 6, "height": 3 },
              "visualization": { "id": "viz.line" },
              "rawConfiguration":
                {
                  "facet": { "showOtherSeries": false },
                  "legend": { "enabled": true },
                  "nrqlQueries":
                    [
                      {
                          "accountId": 0,
                          "query": "SELECT percentile(nginx_ingress_controller_response_duration_seconds, 50, 75, 90) As 'Response duration' FROM Metric TIMESERIES"
                      }
                    ],
                  "platformOptions": { "ignoreTimeRange": false },
                  "yAxisLeft": { "zero": true }
                }
            }
          ]
      }
    ]
}