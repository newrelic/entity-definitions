domain: INFRA
type: ELASTICSEARCHCLUSTER

goldenTags:
- elasticsearch.cluster.name
- host.name

configuration:
  entityExpirationTime: DAILY
  alertable: true

synthesis:
  rules:
  - ruleName: infra_elasticsearchcluster_elasticsearch_cluster_name
    identifier: elasticsearch.cluster.name
    name: elasticsearch.cluster.name
    encodeIdentifierInGUID: true
    conditions:
    - attribute: eventType
      value: Metric
    - attribute: instrumentation.provider
      value: opentelemetry
    - attribute: otel.library.name
      value: "github.com/open-telemetry/opentelemetry-collector-contrib/receiver/elasticsearchreceiver"  
    - attribute: elasticsearch.cluster.name
      present: true
    tags:
      otel.library.name:
        entityTagName: instrumentation.name
      elasticsearch.cluster.name:
      host.name:
  - ruleName: infra_elasticsearchcluster_elasticsearch_cluster_name_2
    identifier: elasticsearch.cluster.name
    name: elasticsearch.cluster.name
    encodeIdentifierInGUID: true
    conditions:
    - attribute: eventType
      value: Metric
    - attribute: instrumentation.provider
      value: opentelemetry
    - attribute: otel.library.name
      value: "otelcol/elasticsearchreceiver"  
    - attribute: elasticsearch.cluster.name
      present: true
    tags:
      otel.library.name:
        entityTagName: instrumentation.name
      elasticsearch.cluster.name:
      host.name:
  - ruleName: infra_elasticsearchcluster_elasticsearch_cluster_name_3
    identifier: elasticsearch.cluster.name
    name: elasticsearch.cluster.name
    encodeIdentifierInGUID: true
    conditions:
    - attribute: eventType
      value: Log
    - attribute: instrumentation.provider
      value: opentelemetry
    - attribute: newrelic.source
      value: 'api.logs.otlp'  
    - attribute: elasticsearch.cluster.name
      present: true
    tags:
      instrumentation.provider:
        entityTagName: instrumentation.name
      elasticsearch.cluster.name:
      host.name:        

  # Data from Elastic search integation OHI
  - ruleName: infra_elasticsearchcluster_entityId
    identifier: entityId
    name: entityName
    legacyFeatures:
      useNonStandardAttributes: true
      overrideGuidType: true
    conditions:
    - attribute: eventType
      value: ElasticsearchClusterSample
    tags:
      displayName:
        entityTagNames: [elasticsearch.cluster.name]

dashboardTemplates:
  newRelic:
      template: newrelic_dashboard.stg.json
  opentelemetry:
    template: opentelemetry_dashboard.stg.json

ownership:
  primaryOwner:
    teamName: "no owner"
