domain: INFRA
type: KAFKACLUSTER
configuration:
  entityExpirationTime: DAILY
  alertable: true

synthesis:
  rules:
    # This rule is for OTEL kafka cluster metrics
  - ruleName: infra_kafkacluster_kafka_cluster_name_stg_1
    identifier: kafka.cluster.name
    name: kafka.cluster.name
    encodeIdentifierInGUID: true
    conditions:
      - attribute: eventType
        value: Metric
      - attribute: kafka.cluster.name
        present: true
      - attribute: broker.id
        present: false
      - attribute: topic
        present: false
      - attribute: client-id
        present: false
      - attribute: instrumentation.provider
        value: opentelemetry
    tags:
      # Environment resource attributes
      instrumentation.provider:
      kafka.cluster.name:
      otel.library.name:
        entityTagName: instrumentation.name
      k8s.namespace.name:

    # This rule is for OTEL kafka cluster logs
  - ruleName: infra_kafkacluster_kafka_cluster_name_stg_2
    identifier: kafka.cluster.name
    name: kafka.cluster.name
    encodeIdentifierInGUID: true
    conditions:
      - attribute: eventType
        value: Log
      - attribute: kafka.cluster.name
        present: true
      - attribute: broker.id
        present: false
      - attribute: topic
        present: false
      - attribute: client-id
        present: false
      - attribute: instrumentation.provider
        value: opentelemetry
    tags:
      # Environment resource attributes
      instrumentation.provider:
      kafka.cluster.name:
      otel.library.name:
        entityTagName: instrumentation.name
      k8s.namespace.name:

    # This rule is for native kafka cluster metrics
  - ruleName: infra_kafkacluster_clusterName_stg_3
    identifier: clusterName
    name: displayName
    encodeIdentifierInGUID: true
    legacyFeatures:
      useNonStandardAttributes: true
      overrideGuidType: true
    conditions:
      - attribute: event_type
        value: "KafkaClusterSample"
    tags:
      # Cluster information
      clusterName:

dashboardTemplates:
  # This should match the entity created from the ohi in the infra pipeline
  newRelic:
    template: newrelic_dashboard.stg.json
  # otel receiver
  opentelemetry:
    template: opentelemetry_dashboard.stg.json

goldenTags:
- clusterName
- kafka.cluster.name

ownership:
  primaryOwner:
    teamName: "OnHost Agent and Integrations"
