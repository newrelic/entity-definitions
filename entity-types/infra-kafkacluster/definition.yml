domain: INFRA
type: KAFKACLUSTER
configuration:
  entityExpirationTime: DAILY
  alertable: true

synthesis:
  rules:
  # This rule is for OTEL kafka cluster metrics from jmx receiver - jmxmetrics
  - ruleName: infra_kafkacluster_otel_jmxmetrics_kafka
    identifier: kafka.cluster.name
    name: kafka.cluster.name
    encodeIdentifierInGUID: true
    conditions:
    - attribute: eventType
      value: Metric
    - attribute: kafka.cluster.name
      present: true
    - attribute: broker.id
      present: false
    - attribute: topic
      present: false
    - attribute: client-id
      present: false
    - attribute: instrumentation.provider
      value: opentelemetry
    - attribute: metricName
      prefix: kafka
    - attribute: otel.library.name
      value: "io.opentelemetry.contrib.jmxmetrics"
    tags:
      # Environment resource attributes
      instrumentation.provider:
      kafka.cluster.name:
      otel.library.name:
        entityTagName: instrumentation.name

  # This rule is for OTEL kafka cluster metrics from jmx receiver - jmxscraper
  - ruleName: infra_kafkacluster_otel_jmxscraper_kafka
    identifier: kafka.cluster.name
    name: kafka.cluster.name
    encodeIdentifierInGUID: true
    conditions:
    - attribute: eventType
      value: Metric
    - attribute: kafka.cluster.name
      present: true
    - attribute: broker.id
      present: false
    - attribute: topic
      present: false
    - attribute: client-id
      present: false
    - attribute: instrumentation.provider
      value: opentelemetry
    - attribute: metricName
      prefix: kafka
    - attribute: otel.library.name
      value: "io.opentelemetry.jmx"
    tags:
      # Environment resource attributes
      instrumentation.provider:
      kafka.cluster.name:
      otel.library.name:
        entityTagName: instrumentation.name

  # This rule is for OTEL kafka cluster metrics from kafka metrics receiver
  - ruleName: infra_kafkacluster_otel_kafkametrics
    identifier: kafka.cluster.name
    name: kafka.cluster.name
    encodeIdentifierInGUID: true
    conditions:
    - attribute: eventType
      value: Metric
    - attribute: kafka.cluster.name
      present: true
    - attribute: broker.id
      present: false
    - attribute: topic
      present: false
    - attribute: client-id
      present: false
    - attribute: instrumentation.provider
      value: opentelemetry
    - attribute: metricName
      prefix: kafka
    - attribute: otel.library.name
      value: "github.com/open-telemetry/opentelemetry-collector-contrib/receiver/kafkametricsreceiver"
    tags:
      # Environment resource attributes
      instrumentation.provider:
      kafka.cluster.name:
      otel.library.name:
        entityTagName: instrumentation.name
    # This rule is for OTEL kafka cluster metrics from prometheus receiver
  - ruleName: infra_kafkacluster_otel_prometheus_kafka
    identifier: kafka.cluster.name
    name: kafka.cluster.name
    encodeIdentifierInGUID: true
    conditions:
    - attribute: eventType
      value: Metric
    - attribute: kafka.cluster.name
      present: true
    - attribute: broker.id
      present: false
    - attribute: topic
      present: false
    - attribute: client-id
      present: false
    - attribute: instrumentation.provider
      value: opentelemetry
    - attribute: metricName
      prefix: kafka
    - attribute: otel.library.name
      value: "github.com/open-telemetry/opentelemetry-collector-contrib/receiver/prometheusreceiver"
    tags:
      # Environment resource attributes
      instrumentation.provider:
      kafka.cluster.name:
      otel.library.name:
        entityTagName: instrumentation.name

  # This rule is for OTEL jvm metrics from jmx receiver - jmxscraper
  - ruleName: infra_kafkacluster_otel_jmxscraper_jvm
    identifier: kafka.cluster.name
    name: kafka.cluster.name
    encodeIdentifierInGUID: true
    conditions:
    - attribute: eventType
      value: Metric
    - attribute: kafka.cluster.name
      present: true
    - attribute: broker.id
      present: false
    - attribute: topic
      present: false
    - attribute: client-id
      present: false
    - attribute: instrumentation.provider
      value: opentelemetry
    - attribute: metricName
      prefix: jvm
    - attribute: otel.library.name
      value: "io.opentelemetry.jmx"
    tags:
      # Environment resource attributes
      instrumentation.provider:
      kafka.cluster.name:
      otel.library.name:
        entityTagName: instrumentation.name

  # This rule is for OTEL jvm metrics from jmx receiver - jmxmetrics
  - ruleName: infra_kafkacluster_otel_jmxmetrics_jvm
    identifier: kafka.cluster.name
    name: kafka.cluster.name
    encodeIdentifierInGUID: true
    conditions:
    - attribute: eventType
      value: Metric
    - attribute: kafka.cluster.name
      present: true
    - attribute: broker.id
      present: false
    - attribute: topic
      present: false
    - attribute: client-id
      present: false
    - attribute: instrumentation.provider
      value: opentelemetry
    - attribute: metricName
      prefix: jvm
    - attribute: otel.library.name
      value: "io.opentelemetry.contrib.jmxmetrics"
    tags:
      # Environment resource attributes
      instrumentation.provider:
      kafka.cluster.name:
      otel.library.name:
        entityTagName: instrumentation.name

  # This rule is for OTEL jvm metrics from prometheus receiver
  - ruleName: infra_kafkacluster_otel_prometheus_jvm
    identifier: kafka.cluster.name
    name: kafka.cluster.name
    encodeIdentifierInGUID: true
    conditions:
    - attribute: eventType
      value: Metric
    - attribute: kafka.cluster.name
      present: true
    - attribute: broker.id
      present: false
    - attribute: topic
      present: false
    - attribute: client-id
      present: false
    - attribute: instrumentation.provider
      value: opentelemetry
    - attribute: metricName
      prefix: jvm
    - attribute: otel.library.name
      value: "github.com/open-telemetry/opentelemetry-collector-contrib/receiver/prometheusreceiver"
    tags:
      # Environment resource attributes
      instrumentation.provider:
      kafka.cluster.name:
      otel.library.name:
        entityTagName: instrumentation.name
    # This rule is for OTEL kafka cluster logs
  - ruleName: infra_kafkacluster_otel_logs
    identifier: kafka.cluster.name
    name: kafka.cluster.name
    encodeIdentifierInGUID: true
    conditions:
    - attribute: eventType
      value: Log
    - attribute: kafka.cluster.name
      present: true
    - attribute: broker.id
      present: false
    - attribute: topic
      present: false
    - attribute: client-id
      present: false
    - attribute: instrumentation.provider
      value: opentelemetry
    tags:
      # Environment resource attributes
      instrumentation.provider:
      kafka.cluster.name:
      otel.library.name:
        entityTagName: instrumentation.name

dashboardTemplates:
  # otel receiver
  opentelemetry:
    template: opentelemetry_dashboard.json

goldenTags:
- clusterName
- kafka.cluster.name

ownership:
  primaryOwner:
    teamName: "OnHost Agent and Integrations"
