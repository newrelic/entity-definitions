{
  "name": "OTEL Kafka Cluster",
  "description": "Performance and health metrics for Kafka Cluster",
  "pages": [
    {
      "name": "Cluster Overview",
      "description": null,
      "widgets": [
        {
          "title": "Brokers",
          "layout": {
            "column": 1,
            "row": 1,
            "width": 2,
            "height": 2
          },
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "SELECT latest(kafka.brokers) as 'Brokers' FROM Metric WHERE metricName='kafka.brokers'"
              }
            ]
          }
        },
        {
          "title": "Topics",
          "layout": {
            "column": 3,
            "row": 1,
            "width": 2,
            "height": 2
          },
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "SELECT uniqueCount(topic.name) as 'Topics' FROM Metric WHERE metricName='kafka.cluster.topic.partitions'"
              }
            ]
          }
        },
        {
          "title": "Partition Count",
          "layout": {
            "column": 5,
            "row": 1,
            "width": 2,
            "height": 2
          },
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "SELECT latest(kafka.partition.count) AS 'Partition Count' FROM Metric WHERE metricName='kafka.partition.count'"
              }
            ]
          }
        },
        {
          "title": "Offline Partitions",
          "layout": {
            "column": 7,
            "row": 1,
            "width": 2,
            "height": 2
          },
          "visualization": {
            "id": "viz.billboard"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "SELECT latest(`kafka.partition.offline`) AS 'Offline Partitions'  FROM Metric WHERE metricName='kafka.partition.offline'"
              }
            ]
          }
        },
        {
          "title": "Consumer Group Members Count",
          "layout": {
            "column": 9,
            "row": 1,
            "width": 4,
            "height": 5
          },
          "visualization": {
            "id": "viz.table"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "SELECT latest(kafka.consumer_group.members) AS 'Count' FROM Metric WHERE metricName = 'kafka.consumer_group.members' FACET group"
              }
            ]
          }
        },
        {
          "title": "Under Replicated Partitions",
          "layout": {
            "column": 1,
            "row": 3,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "SELECT latest(kafka.partition.under_replicated) AS 'Under Replicated Partitions' FROM Metric WHERE metricName='kafka.partition.under_replicated' TIMESERIES AUTO"
              }
            ]
          }
        },
        {
          "title": "In-Sync Replica Operations (per min)",
          "layout": {
            "column": 5,
            "row": 3,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "SELECT rate(sum(kafka.isr.operation.count), 1 minute) AS 'ISR Operations' FROM Metric WHERE metricName = 'kafka.isr.operation.count' TIMESERIES AUTO FACET operation"
              }
            ]
          }
        },
        {
          "title": "Leader Elections Rate (per min)",
          "layout": {
            "column": 1,
            "row": 6,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "SELECT rate(sum(kafka.leader.election.rate), 1 minute) AS 'Leader Elections' FROM Metric WHERE metricName = 'kafka.leader.election.rate' TIMESERIES AUTO"
              }
            ]
          }
        },
        {
          "title": "Unclean Leader Elections Rate (per min)",
          "layout": {
            "column": 5,
            "row": 6,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "SELECT rate(sum(kafka.unclean.election.rate), 1 minute) AS 'Unclean Leader Elections/min' FROM Metric WHERE metricName = 'kafka.unclean.election.rate' TIMESERIES AUTO"
              }
            ]
          }
        },
        {
          "title": "Max Replica Lag (Messages)",
          "layout": {
            "column": 9,
            "row": 6,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "SELECT max(kafka.max.lag) as 'Messages' FROM Metric WHERE metricName = 'kafka.max.lag' TIMESERIES AUTO"
              }
            ]
          }
        },
        {
          "title": "Top Producers: Outgoing Byte Rate",
          "layout": {
            "column": 1,
            "row": 9,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "SELECT average(`kafka.producer.outgoing-byte-rate`) FROM Metric WHERE metricName='kafka.producer.outgoing-byte-rate' FACET `client-id` TIMESERIES AUTO LIMIT 10"
              }
            ]
          }
        },
        {
          "title": "Top Producers: Request Latency (Avg)",
          "layout": {
            "column": 5,
            "row": 9,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "SELECT average(`kafka.producer.request-latency-avg`) FROM Metric WHERE metricName='kafka.producer.request-latency-avg' FACET `client-id` TIMESERIES AUTO LIMIT 10"
              }
            ]
          }
        },
        {
          "title": "Top Producers: Request Rate (Requests/sec)",
          "layout": {
            "column": 9,
            "row": 9,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "SELECT average(`kafka.producer.request-rate`) FROM Metric WHERE metricName = 'kafka.producer.request-rate' FACET `client-id` TIMESERIES AUTO LIMIT 10"
              }
            ]
          }
        },
        {
          "title": "Top Consumers: Records Lag (Max)",
          "layout": {
            "column": 1,
            "row": 12,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "SELECT max(`kafka.consumer.records-lag-max`) FROM Metric WHERE metricName='kafka.consumer.records-lag-max' FACET `client-id` TIMESERIES AUTO LIMIT 10"
              }
            ]
          }
        },
        {
          "title": "Top Consumers: Bytes Consumed Rate",
          "layout": {
            "column": 5,
            "row": 12,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "SELECT average(`kafka.consumer.total.bytes-consumed-rate`) FROM Metric WHERE metricName = 'kafka.consumer.total.bytes-consumed-rate' FACET `client-id` TIMESERIES AUTO LIMIT 10"
              }
            ]
          }
        },
        {
          "title": "Top Consumers: Records Consumed Rate (Records/sec)",
          "layout": {
            "column": 9,
            "row": 12,
            "width": 4,
            "height": 3
          },
          "visualization": {
            "id": "viz.line"
          },
          "rawConfiguration": {
            "nrqlQueries": [
              {
                "accountId": 0,
                "query": "SELECT average(`kafka.consumer.total.records-consumed-rate`) FROM Metric WHERE metricName = 'kafka.consumer.total.records-consumed-rate' FACET `client-id` TIMESERIES AUTO LIMIT 10"
              }
            ]
          }
        }
      ]
    }
  ]
}
