domain: INFRA
type: MONGODB_INSTANCE

synthesis:
  rules:
    - identifier: mongodb.endpoint
      name: mongodb.endpoint
      encodeIdentifierInGUID: true
      conditions:
        - attribute: eventType
          value: Metric
        - attribute: metricName
          prefix: mongodb.
        - attribute: instrumentation.provider
          value: opentelemetry
        - attribute: otel.library.name
          anyOf: 
            - github.com/open-telemetry/opentelemetry-collector-contrib/receiver/mongodbreceiver
      # This filters only metrics coming from mongodbreceiver, given that metrics
      # could differ between different runtime receivers.
      tags:
        otel.library.name:
          entityTagName: instrumentation.name
        telemetry.sdk.name:
          entityTagName: instrumentation.provider
          
    - identifier: mongodb_cluster_name
      encodeIdentifierInGUID: true
      name: mongodb_cluster_name
      conditions:
        - attribute: eventType
          value: Metric
        - attribute: metricName
          prefix: mongodb_oplog_
      tags:
        mongodb_cluster_name:

    - identifier: mongodb_cluster_name
      encodeIdentifierInGUID: true
      name: mongodb_cluster_name
      conditions:
        - attribute: eventType
          value: Metric
        - attribute: metricName
          prefix: mongodb_rs_
      tags:
        mongodb_cluster_name:

    - identifier: mongodb_cluster_name
      encodeIdentifierInGUID: true
      name: mongodb_cluster_name
      conditions:
        - attribute: eventType
          value: Metric
        - attribute: metricName
          prefix: mongodb_ss_
      tags:
        mongodb_cluster_name:

    - identifier: mongodb_cluster_name
      encodeIdentifierInGUID: true
      name: mongodb_cluster_name
      conditions:
        - attribute: eventType
          value: Metric
        - attribute: metricName
          prefix: mongodb_sys_
      tags:
        mongodb_cluster_name:

    - identifier: mongodb_cluster_name
      encodeIdentifierInGUID: true
      name: mongodb_cluster_name
      conditions:
        - attribute: eventType
          value: Metric
        - attribute: metricName
          prefix: mongodb_clusterTime_
      tags:
        mongodb_cluster_name:

    - identifier: mongodb_cluster_name
      encodeIdentifierInGUID: true
      name: mongodb_cluster_name
      conditions:
        - attribute: eventType
          value: Metric
        - attribute: metricName
          prefix: mongodb_electionParticipantMetrics_
      tags:
        mongodb_cluster_name:

    - identifier: mongodb_cluster_name
      encodeIdentifierInGUID: true
      name: mongodb_cluster_name
      conditions:
        - attribute: eventType
          value: Metric
        - attribute: metricName
          prefix: mongodb_electionCandidateMetrics_
      tags:
        mongodb_cluster_name:

    - identifier: mongodb_cluster_name
      encodeIdentifierInGUID: true
      name: mongodb_cluster_name
      conditions:
        - attribute: eventType
          value: Metric
        - attribute: metricName
          prefix: mongodb_heartbeatIntervalMillis
      tags:
        mongodb_cluster_name:

    - identifier: mongodb_cluster_name
      encodeIdentifierInGUID: true
      name: mongodb_cluster_name
      conditions:
        - attribute: eventType
          value: Metric
        - attribute: metricName
          prefix: mongodb_members_
      tags:
        mongodb_cluster_name:

    - identifier: mongodb_cluster_name
      encodeIdentifierInGUID: true
      name: mongodb_cluster_name
      conditions:
        - attribute: eventType
          value: Metric
        - attribute: metricName
          prefix: mongodb_optimes_
      tags:
        mongodb_cluster_name:

    - identifier: mongodb_cluster_name
      encodeIdentifierInGUID: true
      name: mongodb_cluster_name
      conditions:
        - attribute: eventType
          value: Metric
        - attribute: metricName
          prefix: mongodb_writeMajorityCount
      tags:
        mongodb_cluster_name:

dashboardTemplates:
  newRelic:
    template: dashboard.json
    # otel receiver
  opentelemetry:
    template: opentelemetry_dashboard.stg.json


configuration:
  entityExpirationTime: DAILY
  alertable: true
